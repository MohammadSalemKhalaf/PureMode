# ๐ ููุทู ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุงูู

## ๐ฏ ุงููุฏู
ูุธุงู ุฅุดุนุงุฑุงุช ุดุจูู ุจุงูููุณุจูู ููุฃุฏูู ููุชุงุจุนุฉ ุงูุฃุญุฏุงุซ ุงููููุฉ ูู ุงูุชุทุจูู.

---

## ๐ ูุชู ูุชู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุชุ

### 1๏ธโฃ ุชุณุฌูู Admin ุฃู Specialist ุฌุฏูุฏ
**ุงูููุงู:** `controllers/userController.js` - function `register`

```javascript
if (role === 'admin' || role === 'specialist') {
  status = 'pending'; // ุงูุญุงูุฉ ุชุตูุฑ pending ุชููุงุฆูุงู
  
  // ๐ ุฅุฑุณุงู ุฅุดุนุงุฑ ููู ุงูุฃุฏูู ุงูููุจูููู
  await createNotification(
    'new_user_pending',
    `ุทูุจ ุชุณุฌูู ${role === 'admin' ? 'ุฃุฏูู' : 'ุฃุฎุตุงุฆู'} ุฌุฏูุฏ`,
    `${name} (${email}) ูุทูุจ ุงูุชุณุฌูู ููุญุชุงุฌ ููุงููุชู`,
    { user_id, name, email, role }
  );
}
```

**ุงููุชูุฌุฉ:**
- ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ ูุฏุฎู ุจุญุงูุฉ `pending`
- ูู ุงูู admins ุงูููุจูููู ูุญุตููู ุนูู ุฅุดุนุงุฑ
- ุงูุฅุดุนุงุฑ ูุธูุฑ ูู ุงูุฌุฑุณ ๐ ููุฑุงู

---

### 2๏ธโฃ ูุดุฑ ููุดูุฑ ุฌุฏูุฏ ูู ุงููุฌุชูุน
**ุงูููุงู:** `controllers/communityController.js` - function `createPost`

```javascript
await createNotification(
  'new_post',
  'ููุดูุฑ ุฌุฏูุฏ ูู ุงููุฌุชูุน',
  `${user.name} ูุดุฑ ููุดูุฑ ุฌุฏูุฏ`,
  { post_id: newPost.post_id, user_id }
);
```

**ุงููุชูุฌุฉ:**
- ูู ุงูุฃุฏูู ูุญุตููู ุนูู ุฅุดุนุงุฑ
- ูููู ููุฃุฏูู ูุฑุงุฌุนุฉ ุงูููุดูุฑ

---

### 3๏ธโฃ ุญุฐู ููุดูุฑ ูู ูุจู ุงูุฃุฏูู
**ุงูููุงู:** `controllers/adminController.js` - function `deletePostAdmin`

```javascript
await createNotification(
  'post_deleted',
  'ุชู ุญุฐู ููุดูุฑ',
  `ุชู ุญุฐู ููุดูุฑ "${post.content.substring(0, 50)}..." ูู ูุจู ุงูุฃุฏูู`,
  { post_id: postId, deleted_by: req.user.user_id }
);
```

**ุงููุชูุฌุฉ:**
- ุจุงูู ุงูุฃุฏูู ูุญุตููู ุนูู ุฅุดุนุงุฑ ุจุงูุญุฐู
- ูููุชุงุจุนุฉ ูุงูุดูุงููุฉ

---

## ๐ ุฏูุฑุฉ ุญูุงุฉ ุงูุฅุดุนุงุฑ

### ุงููุฑุงุญู:

```
1. ุงูุฅูุดุงุก (Created)
   โ
   is_read = false
   โ
2. ุงูุธููุฑ ูู ุงููุงุฆูุฉ (Visible)
   โ
   ุงูุนุฏุงุฏ ูุฒูุฏ (Badge)
   โ
3. ุงูุถุบุท ุนููู (Clicked)
   โ
   is_read = true
   โ
4. ูุจูู ููู ูุงุญุฏ (Stays 1 day)
   โ
5. ุงูุญุฐู ุงูุชููุงุฆู (Auto Delete)
```

---

## โฐ ูุฏุฉ ุจูุงุก ุงูุฅุดุนุงุฑุงุช

### ๐ ุงูููุงุนุฏ ุงูุญุงููุฉ:

| ุงูุญุงูุฉ | ุงููุฏุฉ | ุงูุชูููุฐ |
|--------|------|---------|
| **ุบูุฑ ููุฑูุก** (`is_read = false`) | ุญุชู 30 ููู | ูุจูู ูู ุงููุงุฆูุฉ |
| **ููุฑูุก** (`is_read = true`) | **ููู ูุงุญุฏ ููุท** | ููุญุฐู ุชููุงุฆูุงู |
| **ุฌููุน ุงูุฅุดุนุงุฑุงุช** | 30 ููู ูุญุฏ ุฃูุตู | ุชูุญุฐู ูููุง ูุงูุช |

### ๐งน ุงูุชูุธูู ุงูุชููุงุฆู:

```javascript
// ูู server.js - ูุดุชุบู ูู 24 ุณุงุนุฉ
setInterval(() => {
  cleanupOldNotifications();      // ุญุฐู ุงูููุฑูุกุฉ > 1 ููู
  deleteVeryOldNotifications();   // ุญุฐู ุงููู > 30 ููู
}, 24 * 60 * 60 * 1000);
```

---

## ๐จ ููู ุชุธูุฑ ุงูุฅุดุนุงุฑุงุช ูู ุงูุชุทุจููุ

### ูู Flutter (`admin_dashboard_screen.dart`):

```dart
// 1. ุนูุฏ ูุชุญ ุงูุชุทุจูู
initState() {
  _loadNotificationsCount(); // ูุฌูุจ ุนุฏุฏ ุบูุฑ ุงูููุฑูุกุฉ
}

// 2. ุงูุฌุฑุณ ูุนุฑุถ ุงูุนุฏุงุฏ
๐ (3) โ Badge ุฃุญูุฑ

// 3. ุนูุฏ ุงูุถุบุท ุนูู ุงูุฌุฑุณ
_showNotificationDropdown() {
  // ูุฌูุจ ุขุฎุฑ 5 ุฅุดุนุงุฑุงุช
  // ููุชุญ ูุงุฆูุฉ ููุณุฏูุฉ
}

// 4. ุนูุฏ ุงูุถุบุท ุนูู ุฅุดุนุงุฑ
onTap: () {
  markAsRead(notification_id);  // ูุญุฏุฏู ูููุฑูุก
  Navigator.push(...);          // ูููู ููุตูุญุฉ ุงูููุงุณุจุฉ
}
```

---

## ๐ API Endpoints

### ุฌูุจ ุงูุฅุดุนุงุฑุงุช:
```http
GET /api/notifications?limit=5
Authorization: Bearer {admin_token}

Response:
{
  "notifications": [...],
  "unread_count": 3
}
```

### ุฅุญุตุงุฆูุงุช:
```http
GET /api/notifications/stats
Authorization: Bearer {admin_token}

Response:
{
  "total": 10,
  "unread": 3,
  "recent_24h": 5
}
```

### ุชุญุฏูุฏ ูููุฑูุก:
```http
PUT /api/notifications/:id/read
Authorization: Bearer {admin_token}
```

### ุชุญุฏูุฏ ุงููู:
```http
PUT /api/notifications/read-all
Authorization: Bearer {admin_token}
```

---

## ๐ ุณููุงุฑูู ูุงูู - ูุซุงู ุนููู

### ุงููุซุงู: ุชุณุฌูู ุฃุฎุตุงุฆู ุฌุฏูุฏ

```
1. ูุณุชุฎุฏู ูุณุฌู ูู specialist
   POST /api/users/register
   {
     "name": "ุฏ. ุฃุญูุฏ ูุญูุฏ",
     "email": "ahmad@example.com",
     "role": "specialist",
     ...
   }

2. ุงููุธุงู:
   โ ูุณุฌู ุงููุณุชุฎุฏู ุจุญุงูุฉ "pending"
   โ ููุดุฆ ุฅุดุนุงุฑ ููู admin
   โ ูุทุจุน ูู console:
      ๐ข Creating notification: new_user_pending
      ๐ฅ Found 5 accepted admins
      โ Created 5 notification(s)

3. ุงูุชุทุจูู (Flutter):
   โ ุงูุฌุฑุณ ูุชุญุฏุซ: ๐(2) โ ๐(3)
   โ ุงูุฅุดุนุงุฑ ูุธูุฑ ูู ุงููุงุฆูุฉ

4. ุงูุฃุฏูู ูุถุบุท ุนูู ุงูุฌุฑุณ:
   โ ูุดูู: "ุทูุจ ุชุณุฌูู ุฃุฎุตุงุฆู ุฌุฏูุฏ"
   โ "ุฏ. ุฃุญูุฏ ูุญูุฏ ูุทูุจ ุงูุชุณุฌูู..."

5. ุงูุฃุฏูู ูุถุบุท ุนูู ุงูุฅุดุนุงุฑ:
   โ is_read = true
   โ ููุชูู ูุตูุญุฉ /admin/pending
   โ ูุฑุงุฌุน ุงูุทูุจ ูููุงูู/ูุฑูุถ

6. ุจุนุฏ ููู ูุงุญุฏ:
   โ ุงููุธุงู ูุญุฐู ุงูุฅุดุนุงุฑ ุชููุงุฆูุงู
   โ (ูุฃูู ุตุงุฑ ููุฑูุก ููุฑ ุนููู 24 ุณุงุนุฉ)
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### โ ุงููุธุงู ูุนูู ุจุงูุดูู ุงูุชุงูู:

1. **ุงูุฅูุดุงุก:** ุชููุงุฆู ุนูุฏ ุงูุฃุญุฏุงุซ ุงููููุฉ
2. **ุงูุฅุดุนุงุฑ:** ููุฑู ููู ุงูุฃุฏูู ุงูููุจูููู
3. **ุงูุนุฑุถ:** ูุงุฆูุฉ ููุณุฏูุฉ ูุซู ุงูููุณุจูู
4. **ุงููุฑุงุกุฉ:** ุนูุฏ ุงูุถุบุท โ is_read = true
5. **ุงูุจูุงุก:** ููู ูุงุญุฏ ุจุนุฏ ุงููุฑุงุกุฉ
6. **ุงูุญุฐู:** ุชููุงุฆู ูู 24 ุณุงุนุฉ

### ๐ฑ ูู ูุฌูุฉ ูุธุฑ ุงูุฃุฏูู:

- ููุชุญ ุงูุชุทุจูู โ ูุดูู ุงูุนุฏุงุฏ ๐(5)
- ูุถุบุท ุนูู ุงูุฌุฑุณ โ ูุงุฆูุฉ ุจุขุฎุฑ 5 ุฅุดุนุงุฑุงุช
- ูุถุบุท ุนูู ุฅุดุนุงุฑ โ ููุชูู ููุตูุญุฉ ุงูููุงุณุจุฉ
- ุงูุฅุดุนุงุฑ ูุฎุชูู ุจุนุฏ ููู ูุงุญุฏ ุชููุงุฆูุงู โ

---

## ๐ง ุงูุชุฎุตูุต

### ุฅุฐุง ุจุฏู ุชุบูุฑ ุงููุฏุฉ:

ูู `notificationController.js`:

```javascript
// ูุชุบููุฑ ูุฏุฉ ุจูุงุก ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุกุฉ
const oneDayAgo = new Date(Date.now() - 2 * 24 * 60 * 60 * 1000); // ููููู

// ูุชุบููุฑ ูุฏุฉ ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
const thirtyDaysAgo = new Date(Date.now() - 60 * 24 * 60 * 60 * 1000); // 60 ููู
```

### ุฅุฐุง ุจุฏู ุชุถูู ููุน ุฅุดุนุงุฑ ุฌุฏูุฏ:

1. ุญุฏุฏ ุงูุญุฏุซ (Event)
2. ุฃุถู `createNotification()` ูู ุงูููุงู ุงูููุงุณุจ
3. ุงุฎุชุฑ ููุน (`type`) ูุงุถุญ
4. ูู Flutter: ุฃุถู ุฃููููุฉ ูููู ููููุน ุงูุฌุฏูุฏ

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุนูู ุจููุงุกุฉ!**
