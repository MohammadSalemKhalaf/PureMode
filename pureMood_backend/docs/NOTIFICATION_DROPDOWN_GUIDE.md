# ๐ ุฏููู Notification Dropdown - ูุซู ุงูููุณ ุจูู

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. โ Dropdown Menu (ูุซู Facebook)
- ุนูุฏ ุงูุถุบุท ุนูู ุงูุฌุฑุณุ ูุธูุฑ ูุงุฆูุฉ ููุณุฏูุฉ (ูุด ุตูุญุฉ ูุงููุฉ)
- ูุนุฑุถ ุขุฎุฑ 5 ุฅุดุนุงุฑุงุช
- ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ููู ุงูุฌุฑุณ
- ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ

### 2. โ ุญุฐู ุชููุงุฆู ููุฅุดุนุงุฑุงุช ุงููุฏููุฉ
- **ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุกุฉ**: ุชูุญุฐู ุจุนุฏ 7 ุฃูุงู
- **ุฌููุน ุงูุฅุดุนุงุฑุงุช**: ุชูุญุฐู ุจุนุฏ 30 ููู
- ุงูุชูุธูู ูุญุฏุซ ุชููุงุฆูุงู ูู 24 ุณุงุนุฉ

### 3. โ UI ูุญุณูู
- ุฃููููุงุช ููููุฉ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ
- ููุช ูุณุจู (ููุฐ 5 ุฏูุงุฆูุ ููุฐ ุณุงุนุฉุ ุฅูุฎ)
- ุชูููุฒ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ุจุฎูููุฉ ุฒุฑูุงุก
- ููุทุฉ ุฒุฑูุงุก ููุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู ูู Flutter

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ ุงูููู
ุงูููู ุฌุงูุฒ ูู: `lib/widgets/notification_dropdown.dart`

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ Dependencies

ูู `pubspec.yaml`:
```yaml
dependencies:
  flutter:
    sdk: flutter
  http: ^1.1.0
```

### ุงูุฎุทูุฉ 3: ุงูุงุณุชุฎุฏุงู ูู AppBar

```dart
import 'package:your_app/widgets/notification_dropdown.dart';

class YourAdminScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Admin Dashboard'),
        actions: [
          // ๐ ููุท ุฃุถู ูุฐุง ุงูุณุทุฑ!
          NotificationDropdown(
            baseUrl: 'http://your-server-url:5000',
            token: yourAdminToken,
          ),
        ],
      ),
      body: YourContent(),
    );
  }
}
```

---

## ๐จ Screenshots ุงูุชุตููู

### ุนูุฏ ูุฌูุฏ ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Admin Dashboard     ๐(3)  โ  โ ุงูุนุฏุงุฏ ุงูุฃุญูุฑ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุนูุฏ ูุชุญ ุงููุงุฆูุฉ:
```
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ  ุงูุฅุดุนุงุฑุงุช    [ุชุญุฏูุฏ ุงููู โ]  โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
                    โ ๐ค ุทูุจ ุชุณุฌูู ุฃุฎุตุงุฆู ุฌุฏูุฏ      โ
                    โ    ุฃุญูุฏ ูุญูุฏ ูุทูุจ ุงูุชุณุฌูู...  โ
                    โ    ููุฐ 5 ุฏูุงุฆู            ๐ต  โ โ ุบูุฑ ููุฑูุก
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
                    โ ๐ ููุดูุฑ ุฌุฏูุฏ ูู ุงููุฌุชูุน      โ
                    โ    ูุญูุฏ ูุดุฑ ููุดูุฑ ุฌุฏูุฏ...     โ
                    โ    ููุฐ ุณุงุนุฉ                   โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
                    โ     ุนุฑุถ ูู ุงูุฅุดุนุงุฑุงุช โ        โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง Backend Configuration

### ุงูุชูุธูู ุงูุชููุงุฆู ููุนูู ูู `server.js`:

```javascript
// โ ุชู ุฅุถุงูุฉ ูุฐุง ุชููุงุฆูุงู:

// ุชูุธูู ููุฑู ุนูุฏ ุจุฏุก ุงูุณูุฑูุฑ (ุจุนุฏ 5 ุซูุงูู)
setTimeout(() => {
  cleanupOldNotifications();      // ุญุฐู ุงูููุฑูุกุฉ (7+ ุฃูุงู)
  deleteVeryOldNotifications();   // ุญุฐู ุงููู (30+ ููู)
}, 5000);

// ุชูุธูู ุชููุงุฆู ูู 24 ุณุงุนุฉ
setInterval(() => {
  cleanupOldNotifications();
  deleteVeryOldNotifications();
}, 24 * 60 * 60 * 1000);
```

---

## ๐ API Changes

### ุฌูุจ ุนุฏุฏ ูุญุฏุฏ ูู ุงูุฅุดุนุงุฑุงุช:
```bash
GET /api/notifications?limit=5
```

**Response:**
```json
{
  "notifications": [
    {
      "notification_id": 1,
      "type": "new_user_pending",
      "title": "ุทูุจ ุชุณุฌูู ุฃุฎุตุงุฆู ุฌุฏูุฏ",
      "message": "ุฃุญูุฏ ูุญูุฏ ูุทูุจ ุงูุชุณุฌูู...",
      "is_read": false,
      "created_at": "2024-11-07T19:30:00.000Z"
    }
  ],
  "unread_count": 3
}
```

---

## ๐ฏ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ูุงูุฃููููุงุช

| ุงูููุน | ุงูุฃููููุฉ | ุงูููู | ุงูุฅุฌุฑุงุก ุนูุฏ ุงูุถุบุท |
|------|---------|-------|------------------|
| `new_user_pending` | ๐ค person_add | ุฃุฒุฑู | ุงูุงูุชูุงู ูุตูุญุฉ ุงูููุงููุงุช |
| `new_post` | ๐ article | ุฃุฎุถุฑ | ุงูุงูุชูุงู ููููุดูุฑ |
| `post_deleted` | ๐๏ธ delete | ุฃุญูุฑ | ุนุฑุถ ุงูุชูุงุตูู |

---

## โฐ ุฌุฏูู ุงูุญุฐู ุงูุชููุงุฆู

| ููุน ุงูุฅุดุนุงุฑ | ุงููุฏุฉ | ุงูุชูุฑุงุฑ |
|------------|------|---------|
| ุฅุดุนุงุฑุงุช ููุฑูุกุฉ | 7 ุฃูุงู | ููููุงู |
| ุฌููุน ุงูุฅุดุนุงุฑุงุช | 30 ููู | ููููุงู |

---

## ๐ ุงูุชุญุฏูุซ ุงูุชููุงุฆู

- ุงูุนุฏุงุฏ ูุชุญุฏุซ **ูู 30 ุซุงููุฉ** ุชููุงุฆูุงู
- ุนูุฏ ูุชุญ ุงููุงุฆูุฉุ ุชูุญููู ุฃุญุฏุซ ุงูุฅุดุนุงุฑุงุช
- ุนูุฏ ุชุญุฏูุฏ ุฅุดุนุงุฑ ูููุฑูุกุ ูุชุญุฏุซ ุงูุนุฏุงุฏ ููุฑุงู

---

## ๐จ ุงูุชุฎุตูุต

### ุชุบููุฑ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ูู ุงููุงุฆูุฉ:

ูู `notification_dropdown.dart`:
```dart
Uri.parse('${widget.baseUrl}/api/notifications?limit=10')  // ุบูุฑ ูู 5 ุฅูู 10
```

### ุชุบููุฑ ููุช ุงูุชุญุฏูุซ:

```dart
_refreshTimer = Timer.periodic(
  const Duration(seconds: 60),  // ุบูุฑ ูู 30 ุฅูู 60 ุซุงููุฉ
  (_) => _loadUnreadCount(),
);
```

### ุชุบููุฑ ูุฏุฉ ุงูุญุฐู ุงูุชููุงุฆู:

ูู `notificationController.js`:
```javascript
// ููุฅุดุนุงุฑุงุช ุงูููุฑูุกุฉ
const sevenDaysAgo = new Date(Date.now() - 14 * 24 * 60 * 60 * 1000); // 14 ููู ุจุฏู 7

// ูุฌููุน ุงูุฅุดุนุงุฑุงุช
const thirtyDaysAgo = new Date(Date.now() - 60 * 24 * 60 * 60 * 1000); // 60 ููู ุจุฏู 30
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุฑ ุงูุนุฏุงุฏ:
```bash
# ุณุฌู ุฏุฎูู ูุฃุฏูู ูุงุญุตู ุนูู token
POST http://localhost:5000/api/users/login

# ุณุฌู ูุณุชุฎุฏู ุฌุฏูุฏ (specialist)
POST http://localhost:5000/api/users/register
Body: { "role": "specialist", ... }

# ุชุญูู ูู ุงูุนุฏุงุฏ ูู ุงูุชุทุจูู - ูุฌุจ ุฃู ูุธูุฑ (1)
```

### 2. ุงุฎุชุจุฑ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ:
- ุงุถุบุท ุนูู ุงูุฌุฑุณ
- ูุฌุจ ุฃู ุชุธูุฑ ูุงุฆูุฉ ุจุงูุฅุดุนุงุฑ ุงูุฌุฏูุฏ
- ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ - ูุฌุจ ุชุญุฏูุฏู ูููุฑูุก

### 3. ุงุฎุชุจุฑ ุงูุญุฐู ุงูุชููุงุฆู:
```sql
-- ูู MySQLุ ุฃูุดุฆ ุฅุดุนุงุฑ ูุฏูู ููุงุฎุชุจุงุฑ
INSERT INTO notifications (admin_id, type, title, message, is_read, created_at)
VALUES (1, 'test', 'Test', 'Test', true, DATE_SUB(NOW(), INTERVAL 8 DAY));

-- ุงูุชุธุฑ ุงูุชูุธูู ุงูุชููุงุฆู ุฃู ููุฐ:
-- ูู Node.js console
const { cleanupOldNotifications } = require('./controllers/notificationController');
cleanupOldNotifications();
```

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ/ุงูููุนุฏููุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. โ `lib/widgets/notification_dropdown.dart` - ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
2. โ `lib/widgets/notification_dropdown_usage.dart` - ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู
3. โ `docs/NOTIFICATION_DROPDOWN_GUIDE.md` - ูุฐุง ุงูุฏููู

### ูููุงุช ููุนุฏููุฉ:
1. โ `server.js` - ุฅุถุงูุฉ scheduled cleanup
2. โ `controllers/notificationController.js` - ุฅุถุงูุฉ cleanup functions

---

## ๐ Quick Start

### ููุจุงููุฏ:
```bash
# 1. ุชุฃูุฏ ุฃู ุฌุฏูู notifications ููุฌูุฏ
mysql -u root -p database_name < migrations/create_notifications_table.sql

# 2. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ
npm run dev

# ูุฌุจ ุฃู ุชุฑู:
# โ Notification cleanup scheduler started
```

### ูููุฑููุช ุฅูุฏ:
```dart
// ูู admin_dashboard.dart ุฃู ุฃู screen ููุฃุฏูู

import 'package:your_app/widgets/notification_dropdown.dart';

// ูู AppBar:
actions: [
  NotificationDropdown(
    baseUrl: 'http://localhost:5000',
    token: adminToken,
  ),
]
```

---

## ๐ก ูุตุงุฆุญ

1. **ุงุณุชุฎุฏู ูู ูู ุตูุญุงุช ุงูุฃุฏูู**: ุถุน ุงูู widget ูู AppBar ุฑุฆูุณู
2. **ุงุญูุธ ุงูู token ุจุดูู ุขูู**: ุงุณุชุฎุฏู SharedPreferences ุฃู Provider
3. **ุฑุงูุจ ุงูู console**: ููุชุฃูุฏ ูู ุนูู ุงูุชูุธูู ุงูุชููุงุฆู
4. **ุงุฎุชุจุฑ ุนูู ุฃุฌูุฒุฉ ุญููููุฉ**: ููุชุฃูุฏ ูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู

---

## ๐ Troubleshooting

### ุงููุดููุฉ: ุงูุนุฏุงุฏ ูุง ูุชุญุฏุซ
**ุงูุญู:**
- ุชุฃูุฏ ุฃู ุงูู token ุตุญูุญ
- ุชุฃูุฏ ูู ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ
- ุงูุชุญ Network tab ูุดูู ุงูู requests

### ุงููุดููุฉ: ุงููุงุฆูุฉ ูุงุฑุบุฉ
**ุงูุญู:**
- ุชุญูู ุฃู ููุงู ุฅุดุนุงุฑุงุช ูุนูุงู: `GET /api/notifications`
- ุชุฃูุฏ ุฃู ุงูู user_id ุตุญูุญ ูู ุงูู token

### ุงููุดููุฉ: ุงูุชูุธูู ุงูุชููุงุฆู ูุง ูุนูู
**ุงูุญู:**
- ุชุญูู ูู console logs ูู ุงูุณูุฑูุฑ
- ูุฌุจ ุฃู ุชุฑู: `๐งน Cleaned up X old notifications`

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉุ ุชุญูู ูู:
1. โ Console logs (Frontend + Backend)
2. โ Network tab ูู Developer Tools
3. โ Database - ุฌุฏูู notifications
4. โ ุงููููุงุช ุงูููุฌูุฏุฉ ูู `/docs`

---

**๐ ุงูุขู ูุฏูู ูุธุงู ุฅุดุนุงุฑุงุช ุงุญุชุฑุงูู ูุซู ุงูููุณ ุจูู ุชูุงูุงู!**
